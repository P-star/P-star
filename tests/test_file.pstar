SCENE main {
	string filename_in = "testfile";
	string filename_out = "testfile_out";

	FILE file_in;
	FILE file_out;

	if (!file_in->open_ro(filename_in)) {
		echo file_in->error() . "\n";
		return 1;
	}
	echo "File '$testfile_in' opened successfully for reading\n";

	if (!file_out->open_truncate(filename_out)) {
		echo file_out->error() . "\n";
		return 1;
	}
	echo "File '$testfile_out' opened successfully for writing\n";

	int i = 0;
	LINE line_in = file_in;
	LINE line_out = file_out;

	while (line_in++) {
		echo "Line $i: $line_in";

		line_out = line_in;
		line_out++;

		i++;
	}

	echo "\n";

	file_out->update();

	file_out->close();
	file_in->close();

	if (!file_out->open_rw(filename_out)) {
		echo file_out->error() . "\n";
		return 1;
	}
	echo "File '$testfile_out' opened successfully for read and write\n";

	line_out = file_out;
	while (1) {
		int inc = line_out++;
		echo "Line out inc: $inc\n";
		if (!inc) {
			break 1;
		}
		echo "Found line $line_out";
		if (line_out =~ /B/) {
			echo "...deleting";
			line_out = "";
		}
		echo "\n";
	}

	file_out->update();
	file_out->close();

	return 0;
}
